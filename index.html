<!DOCTYPE html>
<html>

<head>
  <title>Deeplink Test</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1-crypto-js.js"></script>
</head>

<body>

  <h1>Deeplink Test</h1>

  <button id="deeplinkButton">Open App</button>

  <script>
    const deeplinkButton = document.getElementById('deeplinkButton');

    deeplinkButton.addEventListener('click', () => {
      const deeplinkUrl = 'easyplayer://details'; // Replace with your app's deep link scheme
      const urlVideo = "https://dr-taha.s3.us-east-1.amazonaws.com/Week+4+E2.mp4/out.mpd";
      const studentId = "15";

      // Encryption key provided by the user
      const encryptionKey = 'iV/v60Mdcmq6yHVwqv6h23MIgpbcrUWG1iYWj8iIAeBNUxaDHaUCOlKE2+rrgvrV';

      // Encrypt the data using CryptoJS with the provided encryption key
      const encryptedData = CryptoJS.AES.encrypt(
        JSON.stringify({ url_video: urlVideo, student_id: studentId }), 
        CryptoJS.enc.Base64.parse(encryptionKey)  // Key must be Base64 encoded
      ).toString();

      // Construct the deeplink with encrypted data
      const encryptedDeeplinkUrl = `${deeplinkUrl}?data=${encodeURIComponent(encryptedData)}`;

      // Send data via AJAX (optional)
      fetch('https://easyplayer/details', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          url_video: urlVideo,
          student_id: studentId,
        }),
      })
      .then(response => {
        if (response.ok) {
          console.log("Data sent successfully");
          // Redirect to the deep link
          window.location.href = encryptedDeeplinkUrl;
        } else {
          console.error("Failed to send data");
        }
      })
      .catch(error => console.error("Error:", error));
    });
  </script>

</body>
</html>
